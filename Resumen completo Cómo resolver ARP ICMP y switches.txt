### üìÑ Resumen completo: C√≥mo resolver ejercicios tipo P3 (ARP, ICMP y switches)

---

### ‚úÖ ¬øQu√© pide este ejercicio?

Este tipo de ejercicios te hace simular c√≥mo funciona la red cuando un equipo (como PC2) quiere comunicarse (por ejemplo, hacer ping) a un destino lejano (como 203.0.113.100).

Se divide en:
‚úî Dibujar la topolog√≠a sin VLAN.
‚úî Mostrar paso a paso los intercambios ARP e IP.
‚úî Mostrar c√≥mo los switches aprenden las MAC.

---

### üîë PASOS PARA RESOLVERLO

1Ô∏è‚É£ **Identificar el recorrido**: ¬øqui√©n habla con qui√©n? ¬øQu√© saltos hay?
Ejemplo: PC2 ‚Üí R2 ‚Üí R1 ‚Üí gateway ‚Üí Internet ‚Üí y vuelta.

2Ô∏è‚É£ **Resolver las direcciones MAC (ARP)**: Antes de enviar un paquete, cada equipo necesita conocer la MAC destino (si est√° en la misma red) ‚Üí usa ARP para preguntar.

3Ô∏è‚É£ **Listar los paquetes (ARP e IP)**: Escribir cada paso:

* ARP Request ‚Üí broadcast.
* ARP Reply ‚Üí respuesta directa.
* Paquete IP (ICMP Request) ‚Üí una vez resueltas las MAC.

4Ô∏è‚É£ **Anotar lo que aprende cada switch**: Cuando un switch ve salir un paquete por un puerto, aprende que la MAC origen est√° por ese puerto.

---

### üõ† EJEMPLO RESUELTO (Final\_Dic\_2024)

**Escenario:** PC2 hace ping (ICMP) a 203.0.113.100.

‚úÖ **Pasos del intercambio (b):**

| Paso | Qu√© ocurre                                                       | C√≥mo lo sabes                                              |
| ---- | ---------------------------------------------------------------- | ---------------------------------------------------------- |
| 1    | PC2 ‚Üí ARP Request (broadcast) para saber la MAC de R2            | PC2 no conoce la MAC del gateway (192.168.20.1) ‚Üí usa ARP. |
| 2    | R2 ‚Üí ARP Reply con su MAC                                        | El router responde con su MAC en esa red.                  |
| 3    | PC2 ‚Üí ICMP Request (IP) a destino, MAC destino = R2              | Ahora PC2 sabe la MAC de R2 y puede enviarle el paquete.   |
| 4    | R2 ‚Üí ARP Request (broadcast) para saber MAC de R1 (192.168.50.1) | R2 no sabe la MAC del siguiente salto, pide por ARP.       |
| 5    | R1 ‚Üí ARP Reply con su MAC                                        | R1 responde al ARP.                                        |
| 6    | R2 ‚Üí ICMP Request (IP) a R1                                      | R2 reenv√≠a usando MAC de R1.                               |
| 7    | R1 ‚Üí ARP Request (broadcast) para saber MAC del gateway          | R1 necesita MAC del router final hacia Internet.           |
| 8    | Gateway ‚Üí ARP Reply                                              | Gateway responde.                                          |
| 9    | R1 ‚Üí ICMP Request (IP) a Internet                                | Ya puede enviar el paquete.                                |
| 10   | Gateway ‚Üí ICMP Reply                                             | El destino responde.                                       |
| 11   | R1 ‚Üí R2 ‚Üí ICMP Reply                                             | Respuesta de vuelta.                                       |
| 12   | R2 ‚Üí PC2 ‚Üí ICMP Reply                                            | Respuesta final.                                           |

‚úÖ **Tabla del examen (b, ya resuelta):**

| MAC Origen | MAC Destino | Tipo | VLAN | IP Origen     | MAC Origen (ARP) | IP Destino    | MAC Destino (ARP) | Superior     |
| ---------- | ----------- | ---- | ---- | ------------- | ---------------- | ------------- | ----------------- | ------------ |
| PC2\:E0    | BCAST       | ARP  | 20   | 192.168.20.10 | PC2\:E0          | 192.168.20.1  | 0:0               | -            |
| R2\:E0     | PC2\:E0     | ARP  | 20   | 192.168.20.1  | R2\:E0           | 192.168.20.10 | PC2\:E0           | -            |
| PC2\:E0    | R2\:E0      | IP   | 20   | 192.168.20.10 | -                | 203.0.113.100 | -                 | ICMP Request |
| R2\:E0     | BCAST       | ARP  | 50   | 192.168.50.2  | R2\:E0           | 192.168.50.1  | 0:0               | -            |
| R1\:E0     | R2\:E0      | ARP  | 50   | 192.168.50.1  | R1\:E0           | 192.168.50.2  | R2\:E0            | -            |
| R2\:E0     | R1\:E0      | IP   | 50   | 192.168.20.10 | -                | 203.0.113.100 | -                 | ICMP Request |
| R1\:ppp0   | BCAST       | ARP  | -    | 80.70.60.129  | R1\:ppp0         | 80.70.60.130  | 0:0               | -            |
| GW\:pp0    | R1\:ppp0    | ARP  | -    | 80.70.60.130  | GW\:pp0          | 80.70.60.129  | R1\:ppp0          | -            |
| R1\:ppp0   | GW\:pp0     | IP   | -    | 80.70.60.129  | -                | 203.0.113.100 | -                 | ICMP Request |
| GW\:pp0    | R1\:ppp0    | IP   | -    | 203.0.113.100 | -                | 80.70.60.129  | -                 | ICMP Reply   |
| R1\:E0     | R2\:E0      | IP   | 50   | 203.0.113.100 | -                | 192.168.20.10 | -                 | ICMP Reply   |
| R2\:E0     | PC2\:E0     | IP   | 20   | 203.0.113.100 | -                | 192.168.20.10 | -                 | ICMP Reply   |

‚úÖ **C√≥mo sabes qu√© poner:**

* MAC Origen/Destino ‚Üí seg√∫n qui√©n env√≠a a qui√©n, y si es ARP broadcast.
* Tipo ‚Üí ARP si es consulta/respuesta MAC; IP si es ICMP (ping).
* VLAN ‚Üí seg√∫n la red en que se muevan (20, 50, etc.).
* Superior ‚Üí ICMP solo cuando es paquete IP, vac√≠o en ARP.

‚úÖ **Parte c (aprendizaje switches):**

| Paso                                  | Switch 1 anota | Switch 1 transmite por | Switch 2 anota | Switch 2 transmite por |
| ------------------------------------- | -------------- | ---------------------- | -------------- | ---------------------- |
| (t=1) PC2 hace ARP request en VLAN 20 | PC2‚Üê2          | 3                      | PC2‚Üê1          | 3, 5                   |
| (t=2) R2 contesta ARP reply a PC2     | R2‚Üê3           | 2                      | R2‚Üê5           | 1                      |
| (t=3) PC2 env√≠a ICMP Request a R2     | -              | 3                      | -              | 5                      |
| (t=4) R2 hace ARP request en VLAN 50  | -              | 4                      | -              | 1                      |
| (t=5) R1 contesta ARP reply a R2      | R1‚Üê4           | 3                      | R1‚Üê1           | 5                      |
| (t=6) R2 reenv√≠a ICMP Request a R1    | -              | 4                      | -              | 1                      |
| (t=7) R1 reenv√≠a ICMP Reply a R2      | -              | 3                      | -              | 5                      |
| (t=8) R2 reenv√≠a ICMP Reply a PC2     | -              | 2                      | -              | 1                      |

‚úÖ C√≥mo sabes qu√© poner:

* "Anota" ‚Üí qu√© MAC origen aprendi√≥ el switch y por qu√© puerto.
* "Transmite por" ‚Üí por qu√© puerto env√≠a el tr√°fico cuando no sabe a d√≥nde va.

---

Si quieres, puedo prepararte m√°s ejercicios similares o ejemplos para practicar. ¬°Av√≠same! üí™üìò
